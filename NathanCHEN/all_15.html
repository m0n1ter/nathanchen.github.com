<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>  
	  
  	NathanCHEN
  	
	</title>

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="atom.xml" rel="alternate" title="NathanCHEN" type="application/atom+xml">

	<link href="asset/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="asset/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<script src="asset/javascripts/jquery.min.js"></script>
	<script src="asset/highlightjs/highlight.pack.js"></script>
	<link href="asset/highlightjs/styles/solarized_dark.css" media="screen, projection" rel="stylesheet" type="text/css">
<script>hljs.initHighlightingOnLoad();</script>

	<!--[if lt IE 9]><script src="asset/javascripts/html5.js"></script><![endif]-->
	<!-- <link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'> -->
	<style type="text/css">
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 300;
  src: local('Nunito-Light'), url(asset/font/1TiHc9yag0wq3lDO9cw0voX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 400;
  src: local('Nunito-Regular'), url(asset/font/6TbRXKWJjpj6V2v_WyRbMX-_kf6ByYO6CLYdB4HQE-Y.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 700;
  src: local('Nunito-Bold'), url(asset/font/TttUCfJ272GBgSKaOaD7KoX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
	</style>
	
	<style type="text/css">
	.container .left-col{ opacity: 1;}
	#pagenavi a{ font-size: 1.3em;}
	#pagenavi .next:before{ top: 3px;}
	#pagenavi .prev:before{ top: 3px;}
	.container .mid-col .mid-col-container #content .archives .title{ font-size: 1.5em;}
	.container .mid-col .mid-col-container #content article{ padding: 15px 0px;}
	#header .subtitle {
		line-height: 1.2em;
		padding-top: 8px;
	}
	article pre{ background: none; border: none; padding: 0;}
	article .entry-content{text-align: left;}
	.share-comment{ padding: 25px 0px; clear: both;}
	hr{ margin: 20px 0px;border: 0; border-top:solid 1px #ddd;}
	</style>
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner">
					<div class="profilepic">
						<img src="asset/icon.jpg" style="width:160px;">
					</div>
					<h1><a href="index.html">NathanCHEN</a></h1>
					<p class="subtitle"></p>
					<nav id="main-nav">
						<ul class="main">
							<li><a href="index.html">Home</a></li>
						    <!-- <li><a href="all.html">Blog</a></li>-->	
						    <li><a href="archives.html">Archives</a></li>
						</ul>
					</nav>

					<nav id="sub-nav">
						<div class="social">

<!-- 
			<a class="email" href="mailto:" title="Email">Email</a>
			<a class="facebook" href="http://www.facebook.com/" title="Facebook">Facebook</a>
			<a class="google" href="https://plus.google.com/" rel="author" title="Google+">Google+</a>
			<a class="twitter" href="http://twitter.com/" title="Twitter">Twitter</a>
			<a class="github" href="https://github.com/" title="GitHub">GitHub</a>
			<a class="coderwall" href="https://coderwall.com/" title="Coderwall">Coderwall</a>
		    <a class="stackoverflow" href="http://stackoverflow.com/users/" title="StackOverflow"></a>
			<a class="linkedin" href="http://www.linkedin.com/in/" title="LinkedIn">LinkedIn</a>
			<a class="pinterest" href="https://pinterest.com/" title="Pinterest">Pinterest</a>
			<a class="delicious" href="http://delicious.com/" title="Delicious">Delicious</a>
			<a class="pinboard" href="https://pinboard.in/u:" title="Pinboard">Pinboard</a>
			<a class="douban" href="https://www.douban.com/people/" title="Douban">Douban</a>
			<a class="quora" href="https://quora.com/" title="Quora">Quora</a>
			<a class="instagram" href="https://instagram.com/" title="Instagram">Instagram</a>
			<a class="behance" href="https://www.behance.net/" title="Behance">Behance</a>
			<a class="facebook" href="http://www.facebook.com/" title="Facebook">Facebook</a>
								<a class="twitter" href="http://twitter.com/" title="Twitter">Twitter</a>
								<a class="github" href="https://github.com/" title="GitHub">GitHub</a>
-->	
								

								<a class="rss" href="atom.xml" title="RSS">RSS</a>
							
						</div>
					</nav>
				</header>				
			</div>
		</div>	
		<div class="mid-col">
			<div class="mid-col-container"> <div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2015-10-25T10:47:24+08:00" itemprop="datePublished">2015/10/25</time>
			</div>
			
			 
			
		</div>
		<h1 class="title" itemprop="name"><a href="14457412442112.html" itemprop="url">
		Freemarker Error Handling</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h4 id="toc_0">The possible exception</h4>

<p>The exception that can occur regarding Freemarker could be classified like this:</p>

<ul>
<li>Exceptions occurring when you configure Freemarker: Typically you configure Freemarker only once in your application, when your application initializes itself.</li>
<li><p>Exceptions occurring when loading and parsing templates: When you call <code>Configuration.getTemplate(...)</code>, Freemarker has to load the template file into the memory and parse it. During this, two kinds of exceptions can occur:</p>

<ul>
<li><code>IOException</code> because the template file was not found, or other I/O problem occurred while trying to read it (you have no right to read the file, or there are disk errors).</li>
<li><code>freemarker.core.ParseException</code> because the template file is syntactically incorrrect according the rules of the FTL language. This exception is an <code>IOException</code> subclass.</li>
</ul></li>
<li><p>Exception occurring when executing templates. Two kinds of exceptions can occur:</p>

<ul>
<li><code>IOException</code> because there was an error when trying to write into the output writer.</li>
<li><p><code>freemarker.template.TemplatException</code> because other problem occurred while executing the template. For example, a frequent error is when a template refers to a variable which is not existing. Be default, when a <code>TemplatException</code> occurs, Freemarker prints the FTL error message and the statck trace to the output writer with plain text format, and then aborts the template execution by re-throwing the <code>TemplatException</code>, which then you can catch as <code>Template.process(...)</code> throws it.</p>

<pre><code>class MyTemplateExceptionHandler implements TemplateExceptionHandler {
    public void handleTemplateException(TemplateException te, Environment env, java.io.Writer out)
            throws TemplateException {
        try {
            out.write(&quot;[ERROR: &quot; + te.getMessage() + &quot;]&quot;);
        } catch (IOException e) {
            throw new TemplateException(&quot;Failed to print error message. Cause: &quot; + e, env);
        }
    }
}

...

cfg.setTemplateExceptionHandler(new MyTemplateExceptionHandler());
</code></pre></li>
</ul></li>
</ul>

<h4 id="toc_1">Handling missing values</h4>

<pre><code>${mouse!&quot;No mouse.&quot;}
&lt;#assign mouse=&quot;Jerry&quot;&gt;
${mouse!&quot;No mouse.&quot;}
</code></pre>

<p>The output will be:</p>

<pre><code>No mouse.
Jerry
</code></pre>

<hr/>

<pre><code>product.color!&quot;red&quot;
</code></pre>

<p>This will handle if <code>color</code> is missing inside <code>product</code>, but will not handle if <code>product</code> is missing. That is, the <code>product</code> variable itself must exist, otherwise the template processing will die with error.</p>

<pre><code>(product.color)!&quot;red&quot;
</code></pre>

<p>This will handle if <code>product.color</code> is missing. That is, if <code>product</code> is missing, or <code>product</code> exists but it does not contain <code>color</code>, the result will be <code>red</code>, and no error will occur.</p>

<p>The important difference between this and the previous example is that when surrounded with parentheses, it is allowed for any component of the expression to be undefined, while without parentheses only the last component of the expression is allowed to be undefined.</p>

<h5 id="toc_2">Missing value test operator</h5>

<pre><code>&lt;#if mouse??&gt;
Mouse found
&lt;/#if&gt;
</code></pre>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2015-10-25T10:47:24+08:00" itemprop="datePublished">2015/10/25</time>
			</div>
			
			 
			
		</div>
		<h1 class="title" itemprop="name"><a href="14457412441899.html" itemprop="url">
		---</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<p>layout: post<br/>
title: <q>Levenshtein Distance</q><br/>
category: </p>

<h2 id="toc_0">tags: [<q>读文章</q>,<q>算法</q>]</h2>

<p>{% include JB/setup %}</p>

<p><strong>编辑距离</strong>，又称Levenshtein距离，是值两个字串之间，由一个转成另一个所需的最少编辑操作次数，如果它们的距离越大，说明它们越是不同。</p>

<pre><code>如果str1=&quot;ivan&quot;，str2=&quot;ivan&quot;，那么经过计算后等于 0。没有经过转换。相似度=1-0/Math.Max(str1.length,str2.length)=1

如果str1=&quot;ivan1&quot;，str2=&quot;ivan2&quot;，那么经过计算后等于1。str1的&quot;1&quot;转换&quot;2&quot;，转换了一个字符，所以距离是1，相似度=1-1/Math.Max(str1.length,str2.length)=0.8
</code></pre>

<h5 id="toc_1">算法过程</h5>

<pre><code>1、str1或str2的长度为0， 返回另一个字符串的长度。
2、初始化（n + 1） * (m + 1)的矩阵d，并让第一行和列的值从0开始增长
3、扫描两字符串（n * m），如果：str1[i] == str2[j]，用temp记录它为0；否则temp记为1。然后在矩阵d[i, j]赋予d[i-1,j]+1 、d[i,j-1]+1、d[i-1,j-1]+temp三者的最小值
4、扫描完后，返回矩阵的最后一个值d[n][m]即是他们的距离
</code></pre>

<h6 id="toc_2">第一行和第一列的值从0开始增长</h6>

<p><img src="/img/Levenshtein1.png" alt="img/Levenshtein1.png"/></p>

<h6 id="toc_3">i列值的产生Matrix[i - 1, j] + 1 ; Matrix[i, j - 1] + 1   ;    Matrix[i - 1, j - 1] + t</h6>

<p><img src="/img/Levenshtein2.png" alt="img/Levenshtein2.png"/></p>

<h6 id="toc_4">以此类推直到矩阵全部生成</h6>

<p><img src="/img/Levenshtein3.png" alt="img/Levenshtein3.png"/></p>

<h3 id="toc_5">Reference</h3>

<p><a href="http://www.cnblogs.com/ivanyb/archive/2011/11/25/2263356.html">http://www.cnblogs.com/ivanyb/archive/2011/11/25/2263356.html</a></p>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2015-10-25T10:47:24+08:00" itemprop="datePublished">2015/10/25</time>
			</div>
			
			 
			
		</div>
		<h1 class="title" itemprop="name"><a href="14457412441721.html" itemprop="url">
		---</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<p>layout: post<br/>
title: <q>How to use bloom filter to build a large in memory cache in Java</q><br/>
category: </p>

<h2 id="toc_0">tags: [<q>读文章</q>,<q>算法</q>]</h2>

<p>{% include JB/setup %}</p>

<p><a href="/img/btree1.png">img/btree1.png</a></p>

<p>模拟查找文件29的过程：</p>

<ul>
<li>根据根节点指针找到文件目录的根磁盘块1，将其中的信息导入内存。【磁盘IO操作1次】</li>
<li>此时内存中有文件名17、35和三个存储其他磁盘页面地址的数据。根据算法我们发现：<code>17&lt;29&lt;35</code>，因此我们找到指针p2</li>
<li>根据p2指针，我们定位到磁盘块3，并将其中的信息导入内存【磁盘IO操作2次】</li>
<li>此时内存中有两个文件名26、30和三个存储其他磁盘页面地址的数据。根据算法我们发现：<code>26&lt;29&lt;30</code>，因此我们找到指针p2</li>
<li>根据p2指针，我们定位到磁盘块8，并将其中的信息导入内存。【磁盘IO操作3次】</li>
<li>此时内存中有两个文件名28、29.根据算法我们查找到文件名29，并定位了该文件内存的磁盘地址。</li>
</ul>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2015-10-25T10:47:24+08:00" itemprop="datePublished">2015/10/25</time>
			</div>
			
			 
			
		</div>
		<h1 class="title" itemprop="name"><a href="14457412441548.html" itemprop="url">
		---</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<p>layout: post<br/>
title: <q>How to use bloom filter to build a large in memory cache in Java</q><br/>
category: </p>

<h2 id="toc_0">tags: [<q>读文章</q>,<q>算法</q>]</h2>

<p>{% include JB/setup %}</p>

<ul>
<li>Bloomfilter is designed as an array(A) of m bits. Initially all these bits are set to 0.</li>
</ul>

<h5 id="toc_1">To add item:</h5>

<ul>
<li><p>In order to add any item, it needs to be feed through k hash functions. Each hash function will generate a number which can be treated as a position of the bits array and we shall set that value of that position to 1. For example - first hash function (hash1) on item I produce a bit position x, similarly second and third hash functions produce position y and z.</p>

<p>A[x] = A[y] = A[z] = 1</p></li>
</ul>

<h5 id="toc_2">To find item:</h5>

<ul>
<li>Similar process will be repeated, item will be hashed three times through three different hash functions. Each hash function will produce an integer which will be treated as a position of the array. We shall inspect those x, y, z positions of the bit array and see if they are set to 1 or not. If no, for sure no one ever tried to add this item into bloomfilter, but if all the bits are set, it could be a false positive.</li>
</ul>

<h6 id="toc_3">To design a good bloomfilter we need to keep track of the following things:</h6>

<ul>
<li>Good hash functions that can generate wide range of hash values as quickly as possible</li>
<li>The value of m (size of the bit array) is very important. If the size is too small, all the bits will be set to 1 quickly and false positives will grow largely</li>
<li>Number of hash functions(k) is also important so that the values get distributed evenly</li>
</ul>

<h6 id="toc_4">The formula to calculate k and m:</h6>

<pre><code>m = -nlogp / (log2)^2
where p = desired false positive probability
</code></pre>

<h6 id="toc_5">The formula to determine k (number of hash functions):</h6>

<pre><code>k = m/n log(2)
where k = number of hash functions, 
m = number of bits and 
n = number of items in the filter
</code></pre>

<h5 id="toc_6">Hashing</h5>

<ul>
<li><p>Hashing is an are which affects the performance of bloomfilter. We need to choose a hash function that is effective yet not time consuming.</p></li>
<li><p>We can use two hash functions to generate K number of hash functions.</p>

<pre><code>First we need to calculate two hash function h1(x) and h2(x)
Next, we can use these two hash functions to simulate k hash functions of the nature gi(x) = h1(x) + ih2(x), where i can range from {1...k}

long hash64 = ...; // calculate a 64 bit hash function
// split it in two halves of 32 bit hash values
int hash1 = (int) hash64; 
int hash2 = (int) (hash64 &gt;&gt;&gt; 32);
// Generate k different hash functions with a simple loop
for (int i = 1; i &lt;= numHashFunctions; i ++)
{
    int nextHash = hash1 + i * hash2;
}
</code></pre></li>
</ul>

<h3 id="toc_7">Reference:</h3>

<p><a href="http://www.javacodegeeks.com/2014/07/how-to-use-bloom-filter-to-build-a-large-in-memory-cache-in-java.html">http://www.javacodegeeks.com/2014/07/how-to-use-bloom-filter-to-build-a-large-in-memory-cache-in-java.html</a></p>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2015-10-25T10:47:24+08:00" itemprop="datePublished">2015/10/25</time>
			</div>
			
			 
			
		</div>
		<h1 class="title" itemprop="name"><a href="14457412441370.html" itemprop="url">
		---</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<p>layout: post<br/>
title: <q>Custom Token Filter Lucene</q><br/>
category: </p>

<h2 id="toc_0">tags: [<q>Lucene</q>]</h2>

<p>{% include JB/setup %}</p>

<p>In order to implement our filter we will extends the <code>TokenFilter</code> class from the <code>org.apache.lucene.analysis</code> and we will override the <code>incrementToken</code> method. This method returns a <code>boolean</code> value: <strong>if a value is still available for processing in the token stream, this method should return true</strong>, is the token in the token stream shouldn&#39;t be further analyzed this method should return false.</p>

<pre><code>package pl.solr.analysis;

import java.io.IOException;

import org.apache.lucene.analysis.TokenFilter;
import org.apache.lucene.analysis.TokenStream;
import org.apache.lucene.analysis.tokenattributes.CharTermAttribute;

public final class ReverseFilter extends TokenFilter {
  private CharTermAttribute charTermAttr;

  protected ReverseFilter(TokenStream ts) {
    super(ts);
    this.charTermAttr = addAttribute(CharTermAttribute.class);
  }

  @Override
  public boolean incrementToken() throws IOException {
    if (!input.incrementToken()) {
      return false;
    }

    int length = charTermAttr.length();
    char[] buffer = charTermAttr.buffer();
    char[] newBuffer = new char[length];
    for (int i = 0; i &lt; length; i++) {
      newBuffer[i] = buffer[length - 1 - i];
    }
    charTermAttr.setEmpty();
    charTermAttr.copyBuffer(newBuffer, 0, newBuffer.length);
    return true;
  }
}
</code></pre>

<p>A <code>TokenStream</code> is a class that can produce a series of tokens when requested, but there are two different styles of <code>TokenStreams</code>: <code>Tokenizer</code> and <code>TokenFilter</code>.</p>

<p>A <code>Tokenizer</code> reads characters from a <code>java.io.Reader</code> and creates tokens, whereas a <code>TokenFilter</code> takes tokens in, and produces new tokens by either adding or removing whole tokens or altering the attributes of the incoming tokens.</p>

<pre><code>public TokenStream tokenStream(String fieldName, Reader reader)
{
    return new StopFilter(true, new LowerCaseTokenizer(reader), stopWords);
}
</code></pre>

<p>In this anlyzer, <strong><code>LowerCaseTokenizer</code> produces the initial set of tokens from a Reader and feeds them to a StopFilter</strong>. The <code>LowerCaseTokenizer</code> emits tokens that are adjacent letters in the original text, lowercasing each of the characters in the process. Following this word tokenizer and lowercasing, <strong><code>StopFilter</code> removes words in a stop-word list while preserving accurate <code>positionIncrements</code></strong>.</p>

<p>Buffering is a feature that&#39;s commonly needed in the <code>TokenStream</code> implementations. Low-level <code>Tokenizers</code> do this to buffer up characters to form tokens at boundaries such as whitespace or nonletter characters. <code>TokenFilters</code> that emit additional tokens into the stream they&#39;re filtering must queue an incoming token and the additional ones and emit them one at a time.</p>

<p>the <code>TokenStream</code> never explicitly creates a single object holding all attributes for the token. Instead, you interact with a separate reused attribute interface for each element of the token.</p>

<p><code>TokenStream</code> subclasses from a class called <code>AttributeSource</code>. <code>AttributeSource</code> is a useful and generic means of providing strongly typed yet fully extensible attributes without reuquiring runtime casting, thus resulting in good performance.</p>


			
			
		</div>

	</article>
  

</div>
<nav id="pagenavi">
	 <a class="prev" href="all_14.html">Prev</a>  
	 <a class="next" href="all_16.html">Next</a> 
	<div class="center"><a href="archives.html">Blog Archives</a></div>

</nav>

</div>



        </div>
			<footer id="footer" class="inner">Copyright &copy; 2014
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; 
Theme by <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a>
      </footer>
		</div>
	</div>




</body>
</html>