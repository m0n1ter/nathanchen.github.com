<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>  
	  
  	--- - NathanCHEN
  	
	</title>

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="atom.xml" rel="alternate" title="NathanCHEN" type="application/atom+xml">

	<link href="asset/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="asset/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<script src="asset/javascripts/jquery.min.js"></script>
	<script src="asset/highlightjs/highlight.pack.js"></script>
	<link href="asset/highlightjs/styles/solarized_dark.css" media="screen, projection" rel="stylesheet" type="text/css">
<script>hljs.initHighlightingOnLoad();</script>

	<!--[if lt IE 9]><script src="asset/javascripts/html5.js"></script><![endif]-->
	<!-- <link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'> -->
	<style type="text/css">
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 300;
  src: local('Nunito-Light'), url(asset/font/1TiHc9yag0wq3lDO9cw0voX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 400;
  src: local('Nunito-Regular'), url(asset/font/6TbRXKWJjpj6V2v_WyRbMX-_kf6ByYO6CLYdB4HQE-Y.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 700;
  src: local('Nunito-Bold'), url(asset/font/TttUCfJ272GBgSKaOaD7KoX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
	</style>
	
	<style type="text/css">
	.container .left-col{ opacity: 1;}
	#pagenavi a{ font-size: 1.3em;}
	#pagenavi .next:before{ top: 3px;}
	#pagenavi .prev:before{ top: 3px;}
	.container .mid-col .mid-col-container #content .archives .title{ font-size: 1.5em;}
	.container .mid-col .mid-col-container #content article{ padding: 15px 0px;}
	#header .subtitle {
		line-height: 1.2em;
		padding-top: 8px;
	}
	article pre{ background: none; border: none; padding: 0;}
	article .entry-content{text-align: left;}
	.share-comment{ padding: 25px 0px; clear: both;}
	hr{ margin: 20px 0px;border: 0; border-top:solid 1px #ddd;}
	</style>
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner">
					<div class="profilepic">
						<img src="asset/icon.jpg" style="width:160px;">
					</div>
					<h1><a href="index.html">NathanCHEN</a></h1>
					<p class="subtitle"></p>
					<nav id="main-nav">
						<ul class="main">
							<li><a href="index.html">Home</a></li>
						    <!-- <li><a href="all.html">Blog</a></li>-->	
						    <li><a href="archives.html">Archives</a></li>
						</ul>
					</nav>

					<nav id="sub-nav">
						<div class="social">

<!-- 
			<a class="email" href="mailto:" title="Email">Email</a>
			<a class="facebook" href="http://www.facebook.com/" title="Facebook">Facebook</a>
			<a class="google" href="https://plus.google.com/" rel="author" title="Google+">Google+</a>
			<a class="twitter" href="http://twitter.com/" title="Twitter">Twitter</a>
			<a class="github" href="https://github.com/" title="GitHub">GitHub</a>
			<a class="coderwall" href="https://coderwall.com/" title="Coderwall">Coderwall</a>
		    <a class="stackoverflow" href="http://stackoverflow.com/users/" title="StackOverflow"></a>
			<a class="linkedin" href="http://www.linkedin.com/in/" title="LinkedIn">LinkedIn</a>
			<a class="pinterest" href="https://pinterest.com/" title="Pinterest">Pinterest</a>
			<a class="delicious" href="http://delicious.com/" title="Delicious">Delicious</a>
			<a class="pinboard" href="https://pinboard.in/u:" title="Pinboard">Pinboard</a>
			<a class="douban" href="https://www.douban.com/people/" title="Douban">Douban</a>
			<a class="quora" href="https://quora.com/" title="Quora">Quora</a>
			<a class="instagram" href="https://instagram.com/" title="Instagram">Instagram</a>
			<a class="behance" href="https://www.behance.net/" title="Behance">Behance</a>
			<a class="facebook" href="http://www.facebook.com/" title="Facebook">Facebook</a>
								<a class="twitter" href="http://twitter.com/" title="Twitter">Twitter</a>
								<a class="github" href="https://github.com/" title="GitHub">GitHub</a>
-->	
								

								<a class="rss" href="atom.xml" title="RSS">RSS</a>
							
						</div>
					</nav>
				</header>				
			</div>
		</div>	
		<div class="mid-col">
			<div class="mid-col-container"> <div id="content" class="inner">

	<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
		<h1 class="title" itemprop="name">---</h1>
		<div class="entry-content" itemprop="articleBody">
			<p>layout: post<br/>
title: <q>理解OAuth2.0</q><br/>
category: Reading Notes</p>

<h2 id="toc_0">tags: [<q>读文章</q>, <q>iOS</q>]</h2>

<p>{% include JB/setup %}</p>

<h4 id="toc_1">sqlite3_prepare_v2</h4>

<pre><code>int sqlite3_prepare_v2(
    sqlite3 *db,                 //指向数据库的指针
    const char *zSql,         //SQL语句
    int nByte,                   //SQL语句的长度 （一般用-1，系统可以自动算出字符串得长度）
    sqlite3_stmt **ppStmt, //指向语句的指针
    const char **pzTail       //SQL中没有用到的一部分，一般为空
);
</code></pre>

<h4 id="toc_2">对整数值的绑定</h4>

<pre><code>int sqlite3_bind_int(
    sqlite3_stmt*,            //指向语句的指针
    int,                      //占位符的序号（从1开始以此类推）
    int                       //绑定的值
);
</code></pre>

<h4 id="toc_3">对字符串值的绑定</h4>

<pre><code>int sqlite3_bind_text(
    sqlite3_stmt*,            //指向语句的指针
    int,                      //占位符的序号（从1开始以此类推）
    const char*,              //要绑定的值（这里要c类型的字符串（CString），一般我们使用的是oc的字符串（NSString*）要通过- (__strong const char *)UTF8String转一下就可以了）
    int n,                    //该字符串的长度（一般用-1，系统可以自动算出字符串得长度）
    void(*)(void*)            //回调函数（这里博主还没用过所以不是很了解以后会慢慢更新）
);
</code></pre>

<h4 id="toc_4">对二进制数据值的绑定</h4>

<pre><code>int sqlite3_bind_blob(
    sqlite3_stmt*,            //指向语句的指针
    int,                      //占位符的序号（从1开始以此类推）
    const void*,              //要绑定的值（这里要的是c类型的比特（Byte），一般我们使用的是oc的NSDATA（NsData*）要通过- (const void *)bytes转一下就可以了）
    int n,                    //数据的长度（用- (NSUInteger)length得到  这里为什么不用-1呢？因为-1对于算字符串长度在行，其他的不一定准所以这里我们手动算出数据的长度）
    void(*)(void*)            //回调函数（这里博主还没用过所以不是很了解以后会慢慢更新）
);
</code></pre>

<h4 id="toc_5">对整数字段的取值</h4>

<pre><code>int sqlite3_column_int(
    sqlite3_stmt*,            //指向语句的指针
    int iCol                  //数据库中表中列的序号（从0开始以此类推）
);
</code></pre>

<h4 id="toc_6">对字符串字段的取值</h4>

<p>注意这里我们取得是无符号的c字符串我们要先转为有符号C字符串再转为<code>Objective-C</code>字符串</p>

<pre><code>例sname为oc字符串
NSString *sname=[NSString stringWithUTF8String:(const char *)sqlite3_column_text(stmt, 1)];

const unsigned char *sqlite3_column_text(
    sqlite3_stmt*,            //指向语句的指针
    int iCol                  //数据库中表中列的序号（从0开始以此类推）
);
</code></pre>

<h4 id="toc_7">对二进制字段的取值</h4>

<p>注意这里我们取得是c二进制我们要转为<code>Objective-C</code>二进制（我们要将<code>byte（c）</code>转为<code>NSData（oc）</code>通过<code>+ (id)dataWithBytes:(const void *)bytes length:(NSUInteger)length;</code>因为这里需要数据的长度所以需要调用<code>int sqlite3_column_bytes(sqlite3_stmt*, int iCol);</code>获取数据的长度）</p>

<pre><code>int length = sqlite3_column_bytes(stmt,3);//获取二进制数据的长度
NSData *img = [NSData dataWithBytes:sqlite3_column_blob(stmt, 3) length:length]; //将二进制数据转换位NSData对象

const void *sqlite3_column_blob(
    sqlite3_stmt*,            //指向语句的指针
    int iCol                  //数据库中表中列的序号（从0开始以此类推）
);
</code></pre>

<h3 id="toc_8">实例</h3>

<p>新建一个类（Student）</p>

<p>包含以下属性</p>

<pre><code>@property (retain,nonatomic) NSString *sname;
@property (assign,nonatomic) int sage;
@property (retain,nonatomic) NSData *simage;
@property (assign,nonatomic) int sid;
</code></pre>

<p>1.数据库的全表查询</p>

<pre><code>+ (NSMutableArray*)findall
{
    NSMutableArray* stuArray;//在这里只声明不开辟空间 等用的时候再开辟（节省空间）
    sqlite3 *sqlite = [DataBase OpenDB];
    sqlite3_stmt *stmt = nil;
    int flag = sqlite3_prepare_v2(sqlite, &quot;select * from tblstudent&quot;, -1, &amp;stmt, nil);
    if (flag == SQLITE_OK) 
    {
        stuArray = [[NSMutableArray alloc] init];//为数组开辟空间
        while (sqlite3_step(stmt) == SQLITE_ROW) //开始指向第一行的上面 判断下一行是否存在（存在：做准备指针移到下一行）（不存在：跳出循环）
        {
            int sid1 = sqlite3_column_int(stmt, 0);
            int sage = sqlite3_column_int(stmt, 2);
            NSString *sname1 = [NSString stringWithUTF8String:(const char *)sqlite3_column_text(stmt, 1)];//获取当前表中当前行第二列的值
            int length = sqlite3_column_bytes(stmt,3);//获取二进制数据的长度 sqlite3_column_bytes（）：获取当前行某一列的所占内存的字节数
            NSData *img1 = [NSData dataWithBytes:sqlite3_column_blob(stmt, 3) length:length]; //将二进制数据转换位NSData对象
            //定义一个（Student*）对象并将从数据库取来的数据赋值给对象的相应属性
            Student *stu = [[Student alloc] init];//实例化
            stu.sid = sid1;
            stu.sname = sname1;
            stu.simage = img1;
            stu.sage = sage;
            [stuArray addObject:stu];//将一个对象存入数组
            [stu release];//释放对象
        }
    }
    sqlite3_finalize(stmt);//回收stmt对象
    return [stuArray autorelease];//返回包含学生信息的数组  并设为自动释放
}
</code></pre>

<p>2.通过姓名或者学号查询</p>

<pre><code>+(Student*)findbysid:(int)sid
{
    Student *stu;//用于返回的学生对象
    sqlite3 *sqlite = [DataBase OpenDB];//打开数据库
    sqlite3_stmt *stmt = nil;//定义sql语句对象
    int flag = sqlite3_prepare_v2(sqlite, &quot;select * from tblstudent where stuid=?&quot;, -1, &amp;stmt, nil);//调用预处理函数将sql语句赋值给stmt对象
    if (flag == SQLITE_OK)
    {
        sqlite3_bind_int(stmt, 1, sid);//给问号占位符赋值
        while (sqlite3_step(stmt) == SQLITE_ROW)//因为一个学号肯定对应一个学生所以这里其实只执行一次
        {
            //根据列顺序（从零开始）
            int sid = sqlite3_column_int(stmt, 0);//取整型数据
            int sage = sqlite3_column_int(stmt, 2);
            NSString *sname = [NSString stringWithUTF8String:(const char *)sqlite3_column_text(stmt, 1)];//取nsstring数据
            int length = sqlite3_column_bytes(stmt,3);//获取二进制数据的长度
            NSData *img = [NSData dataWithBytes:sqlite3_column_blob(stmt, 3) length:length]; //将二进制数据转换位NSData对象
            //将从数据库中查询来的数据存到（Student*）对象中，用于返回 
            stu = [[Student alloc]init];//此时开辟空间节省内存
            stu.sid = sid;
            stu.sname = sname;
            stu.simage = img;
            stu.sage = sage;
        }
    }
    sqlite3_finalize(stmt);//回收stmt对象
    return [stu autorelease];//返回包含学生信息的对象
}
</code></pre>

<p>3.向数据库增加一条记录</p>

<pre><code>+ (void)insertstudent:(NSString*)name age:(int)age image:(NSData*)image
{
    sqlite3 *sqlite =[ DataBase OpenDB];//打开数据库
    sqlite3_stmt *stmt = nil;//定义sql语句对象
    int flag = sqlite3_prepare_v2(sqlite, &quot;insert into tblstudent(stuname,stuage,stuimage) values(?,?,?)&quot;, -1, &amp;stmt, nil);//调用预处理函数将sql语句赋值给stmt对象  多值绑定逗号隔开
    if (flag == SQLITE_OK)
    {
        sqlite3_bind_text(stmt, 1, [name UTF8String],-1,nil);//给问号占位符赋值
        sqlite3_bind_int(stmt, 2, age);//对整型数据的绑定
        sqlite3_bind_blob(stmt, 3, [image bytes], [image length], nil);//对二进制类型数据的绑定 数据的字节数（-1 针对字符串的长度比较准）
        if(sqlite3_step(stmt) == SQLITE_ERROR)//执行insert动作
        {
            NSLog(@&quot;insert error&quot;);
        }
    }
    sqlite3_finalize(stmt);//回收stmt对象
}
</code></pre>

<p>4.修改更新数据库的数据</p>

<pre><code>+ (void)updatestudent:(Student*) stu
{
    sqlite3 *sqlite = [DataBase OpenDB];//打开数据库
    sqlite3_stmt *stmt = nil;//定义sql语句对象
    int flag = sqlite3_prepare_v2(sqlite, &quot;update tblstudent set stuname=?,stuage=?,stuimage=? where stuid=?&quot;, -1, &amp;stmt, nil);//调用预处理函数将sql语句赋值给stmt对象
    if (flag == SQLITE_OK)
    {
        sqlite3_bind_text(stmt, 1, [stu.sname UTF8String],-1,nil);//给问号占位符赋值
        //stu.sname为nsstring    UTF8String    nsstring----&gt;ctring
        sqlite3_bind_int(stmt, 4, stu.sid);//给问号占位符赋值
        sqlite3_bind_int(stmt, 2, stu.sage);//给年龄赋值
        sqlite3_bind_blob(stmt, 3, [stu.simage bytes], [stu.simage length], nil);
        if(sqlite3_step(stmt) == SQLITE_ERROR)//执行update动作
        {
            NSLog(@&quot;update error&quot;);
        }
        sqlite3_finalize(stmt);//回收stmt对象
    }
}
</code></pre>

<p>5.删除数据库的记录</p>

<pre><code>+ (void)deletebysid:(int) sid
{
    sqlite3 *sqlite=[DataBase OpenDB];//打开数据库
    sqlite3_stmt *stmt=nil;//定义sql语句对象
    int flag=sqlite3_prepare_v2(sqlite, &quot;delete from tblstudent where stuid=?&quot;, -1, &amp;stmt, nil);//调用预处理函数将sql语句赋值给stmt对象
    if (flag==SQLITE_OK)
    {
        sqlite3_bind_int(stmt, 1, sid);//给问号占位符赋值  1.语句2.占位符的序号3.给占位符赋得值
        //执行delete动作
        if(sqlite3_step(stmt)==SQLITE_ERROR)//未执行成功
        {
            NSLog(@&quot;delete error&quot;);
        }
    }
    sqlite3_finalize(stmt);//回收stmt对象

    NSLog(@&quot;删除了第%d&quot;,sid);
}
</code></pre>

<h4 id="toc_9">Reference</h4>

<p><a href="http://www.cnblogs.com/jy578154186/archive/2012/10/18/2730113.html">http://www.cnblogs.com/jy578154186/archive/2012/10/18/2730113.html</a></p>

		</div>
	</article>
	<div class="share-comment">
	
	</div>
</div>        </div>
			<footer id="footer" class="inner">Copyright &copy; 2014
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; 
Theme by <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a>
      </footer>
		</div>
	</div>




</body>
</html>