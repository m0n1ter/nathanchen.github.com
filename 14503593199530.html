<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>  
	  
  	看透Spring MVC - NathanCHEN
  	
	</title>

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="atom.xml" rel="alternate" title="NathanCHEN" type="application/atom+xml">

	<link href="asset/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="asset/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<script src="asset/javascripts/jquery.min.js"></script>
	<script src="asset/highlightjs/highlight.pack.js"></script>
	<link href="asset/highlightjs/styles/solarized_dark.css" media="screen, projection" rel="stylesheet" type="text/css">
<script>hljs.initHighlightingOnLoad();</script>

	<!--[if lt IE 9]><script src="asset/javascripts/html5.js"></script><![endif]-->
	<!-- <link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'> -->
	<style type="text/css">
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 300;
  src: local('Nunito-Light'), url(asset/font/1TiHc9yag0wq3lDO9cw0voX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 400;
  src: local('Nunito-Regular'), url(asset/font/6TbRXKWJjpj6V2v_WyRbMX-_kf6ByYO6CLYdB4HQE-Y.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 700;
  src: local('Nunito-Bold'), url(asset/font/TttUCfJ272GBgSKaOaD7KoX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
	</style>
	
	<style type="text/css">
	.container .left-col{ opacity: 1;}
	#pagenavi a{ font-size: 1.3em;}
	#pagenavi .next:before{ top: 3px;}
	#pagenavi .prev:before{ top: 3px;}
	.container .mid-col .mid-col-container #content .archives .title{ font-size: 1.5em;}
	.container .mid-col .mid-col-container #content article{ padding: 15px 0px;}
	#header .subtitle {
		line-height: 1.2em;
		padding-top: 8px;
	}
	article pre{ background: none; border: none; padding: 0;}
	article .entry-content{text-align: left;}
	.share-comment{ padding: 25px 0px; clear: both;}
	hr{ margin: 20px 0px;border: 0; border-top:solid 1px #ddd;}
	</style>
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner">
					<div class="profilepic">
						<img src="asset/icon.jpg" style="width:160px;">
					</div>
					<h1><a href="index.html">NathanCHEN</a></h1>
					<p class="subtitle"></p>
					<nav id="main-nav">
						<ul class="main">
							<li><a href="index.html">Home</a></li>
						    <!-- <li><a href="all.html">Blog</a></li>-->	
						    <li><a href="archives.html">Archives</a></li>
						</ul>
					</nav>

					<nav id="sub-nav">
						<div class="social">

<!-- 
			<a class="email" href="mailto:" title="Email">Email</a>
			<a class="facebook" href="http://www.facebook.com/" title="Facebook">Facebook</a>
			<a class="google" href="https://plus.google.com/" rel="author" title="Google+">Google+</a>
			<a class="twitter" href="http://twitter.com/" title="Twitter">Twitter</a>
			<a class="github" href="https://github.com/" title="GitHub">GitHub</a>
			<a class="coderwall" href="https://coderwall.com/" title="Coderwall">Coderwall</a>
		    <a class="stackoverflow" href="http://stackoverflow.com/users/" title="StackOverflow"></a>
			<a class="linkedin" href="http://www.linkedin.com/in/" title="LinkedIn">LinkedIn</a>
			<a class="pinterest" href="https://pinterest.com/" title="Pinterest">Pinterest</a>
			<a class="delicious" href="http://delicious.com/" title="Delicious">Delicious</a>
			<a class="pinboard" href="https://pinboard.in/u:" title="Pinboard">Pinboard</a>
			<a class="douban" href="https://www.douban.com/people/" title="Douban">Douban</a>
			<a class="quora" href="https://quora.com/" title="Quora">Quora</a>
			<a class="instagram" href="https://instagram.com/" title="Instagram">Instagram</a>
			<a class="behance" href="https://www.behance.net/" title="Behance">Behance</a>
			<a class="facebook" href="http://www.facebook.com/" title="Facebook">Facebook</a>
								<a class="twitter" href="http://twitter.com/" title="Twitter">Twitter</a>
								<a class="github" href="https://github.com/" title="GitHub">GitHub</a>
-->	
								

								<a class="rss" href="atom.xml" title="RSS">RSS</a>
							
						</div>
					</nav>
				</header>				
			</div>
		</div>	
		<div class="mid-col">
			<div class="mid-col-container"> <div id="content" class="inner">

	<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
		<h1 class="title" itemprop="name">看透Spring MVC</h1>
		<div class="entry-content" itemprop="articleBody">
			<p>缓存的失效可以定期失效，也可以在数据发生变化的时候失效，如果按数据发生变化让缓存失效，还可以分粗粒度失效和细粒度失效。</p>

<p>像快递送货一样，货单上填写地址的规则以及怎么根据填写的内容找到客户，这就相当于IP协议，而送货时要先打电话，然后将货物送过去，最后客户签收时要签字就相当于TCP协议。</p>

<p>三次握手和四次挥手保证了连接的可靠性，不过这种模式也有它的缺点，首先是在传输效率上会比较低，另外三次握手的过程中客户端需要发送两次数据才可以建立连接，这种特征可能被一些别有用心的人利用，比如，发出第一次握手后就不回应第三次握手了，这时服务端会以为是第二次握手的数据在传输过程中丢失了，然后重新发送第二次握手，默认情况下会一直发送五次，如果发送五次后还收不到第三次握手则会丢弃请求。这就是<code>DDOS</code>攻击中的<code>SYN Flood</code>攻击，对于这种攻击的一种应对方法是设置第二次请求的重发次数，不过重发的次数大小也可能导致正常的请求中因为网络没有收到第二次握手而连接失败的情况。</p>

<p>通过<code>TCP/IP</code>协议、<code>HTTP</code>协议已经可以得到数据了，<code>Servlet</code>的作用是对接收到的数据进行处理并生成要返回给客户端的结果。</p>

<p>域名解析有很多种解析的类型，如常用的A记录和CNAME记录。A记录是将域名解析到IP（一个域名可以有多条A记录），CNAME记录是将域名解析到另一个域名（也就是作为另一个域名的别名），查找时会返回目标域名所对应的IP</p>

<p><code>ServerSocket</code>的使用可以分为三步：<br/>
- 创建<code>ServerSocket</code>：<br/>
- 调用创建出来的<code>ServerSocket</code>的<code>accept</code>方法进行监听。<code>accept</code>方法是阻塞方法，也就是说调用<code>accept</code>方法后程序会停下来等待连接请求，在接收到请求之前程序都不会往下走；当接收到请求后<code>accept</code>方法会返回一个<code>Socket</code><br/>
- 使用<code>accept</code>方法返回的<code>Socket</code>与客户端进行通信</p>

<p>普通<code>Socket</code>处理请求的模式：收到请求，处理，处理好了，收下一个请求。</p>

<p><code>NIOSocket</code>处理请求的模式：快递并不会一件一件地送，而是将很多件货一起拿去送，而且在中转站都有专门的分拣员负责按配送范围将货物分给不同的送货员，这样效率就提高了很多。</p>

<p><code>NIOSocket</code>使用中首先要创建<code>ServerSocketChannel</code>，然后注册<code>Selector</code>，接下来就可以用<code>Selector</code>接受请求并处理了。</p>

<p><code>NIOSocket</code>中服务端的处理过程可以分为5步：<br/>
1、创建<code>ServerSocketChannel</code>并设置相应参数<br/>
2、创建<code>Selector</code>并注册到<code>ServerSocketChannel</code>上<br/>
3、调用<code>Selector</code>的<code>select</code>方法等待请求<br/>
4、<code>Selector</code>接收到请求后使用<code>selectedKeys</code>返回<code>SelectionKey</code>集合<br/>
5、使用<code>SelectionKey</code>获取到<code>Channel</code>，<code>Selector</code>和操作类型并进行具体操作</p>

<pre><code>// 恢复到初始状态
public final Buffer clear()
{
    position = 0;
    limit = capacity;
    mark = -1;
    return this;
}

// 开启读的模式
public final Buffer flip()
{
    limit = position;
    position = 0;
    mark = -1;
    return this;
}
</code></pre>

<p><code>Servlet</code>接口<br/>
- <code>init</code>方法在容器启动时被容器调用（当<code>load-on-startup</code>设置为负数或者不设置时会在<code>Servlet</code>第一次用到时才被调用），只会调用一次<br/>
- <code>getServletConfig</code>方法用于获取<code>ServletConfig</code><br/>
- <code>service</code>方法用于具体处理一个请求<br/>
- <code>getServletInfo</code>方法可以获取一些<code>Servlet</code>相关的信息，默认返回空字符串<br/>
- <code>destroy</code>主要用于在<code>Servlet</code>销毁（一般指关闭服务器）时释放一些资源，只会调用一次</p>

<p><code>getServletName</code>用于获取Servlet的名字，也就是我们在<code>web.xml</code>中定义的<code>servlet-name</code>；<code>getInitParameter</code>方法用于获取<code>init-param</code>配置的参数；<code>getInitParameterNames</code>用于获取配置的所有<code>init-param</code>的名字集合；<code>getServletContext</code>的返回值代表的是我们这个应用本身。<code>ServletConfig</code>是<code>Servlet</code>级的，而<code>ServletContext</code>是<code>Context</code>（也就是<code>Application</code>）级的。</p>

<pre><code>String contextLocation = getServletConfig().getServletContext().getInitParameter(&quot;contextConfigLocation&quot;);
String servletLocation = getServletConfig().getInitParameter(&quot;contextConfigLocation&quot;);
</code></pre>

<h4 id="toc_0">GenericServlet</h4>

<p><code>GenericServlet</code>是<code>Servlet</code>的默认实现，主要是做了三件事：<br/>
- 实现了<code>ServletConfig</code>接口，我们可以直接调用<code>ServletConfig</code>里面的方法<br/>
- 提供了无参的<code>init</code>方法<br/>
- 提供了<code>log</code>方法</p>

<p><code>GenericServlet</code>实现了<code>Servlet</code>的<code>init(ServletConfig config)</code>方法，在里面将<code>config</code>设置给了内部变量<code>config</code>，然后调用了无参的<code>init()</code>方法</p>

<pre><code>public void init(ServletConfig config) throws ServletException {
    this.config = config;
    this.init();
}
public void init() throws ServletException {

}
</code></pre>

<h4 id="toc_1">HttpServlet</h4>

<p><code>HttpServlet</code>是用<code>HTTP</code>协议实现的<code>Servlet</code>的基类。<code>HttpServlet</code>主要重写了<code>service</code>方法。在<code>service</code>方法中首先将<code>ServletRequest</code>和<code>ServletResponse</code>转换为了<code>HttpServletRequest</code>和<code>HttpServletResponse</code>，然后根据<code>Http</code>请求的类型不同将请求路由到了不同的处理方法</p>

<h4 id="toc_2">Tomcat的顶层结构</h4>

<p><code>Tomcat</code>中最顶层的容器叫<code>Server</code>，代表整个服务器，<code>Server</code>中包含至少一个<code>Service</code>，用于具体提供服务。<code>Service</code>主要包含两部分：<code>Connector</code>和<code>Container</code>。<code>Connector</code>用于处理连接相关的事情，并提供<code>Socket</code>与<code>request</code>、<code>response</code>的转换，<code>Container</code>用于封装和管理<code>Servlet</code>，以及具体处理<code>request</code>请求。</p>

<p>一个<code>Tomcat</code>中只有一个<code>Server</code>，一个<code>Server</code>可以包含多个<code>Service</code>，一个<code>Service</code>只有一个<code>Container</code>，但可以有多个<code>Connectors</code>（因为一个服务可以有多个连接）</p>

<h4 id="toc_3">Server的启动过程</h4>

<p>await方法处理的大概逻辑是首先判断端口号port，然后根据port的值分为三种处理方法：<br/>
- port为-2，则会直接退出，不进入循环<br/>
- port为-1，则会进入一个while(!stopAwait)的循环，只有在外部调用stop方法才会退出循环<br/>
- port为其他值，则也会进入一个while(!stopAwait)的循环，不过同时会在port所在的端口启动一个ServerSocket来监听关闭命令，如果姐收到了则会使用break跳出循环</p>

		</div>
	</article>
	<div class="share-comment">
	
	</div>
</div>        </div>
			<footer id="footer" class="inner">Copyright &copy; 2014
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; 
Theme by <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a>
      </footer>
		</div>
	</div>




</body>
</html>